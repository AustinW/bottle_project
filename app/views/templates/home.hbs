
<canvas class="blur" data-src="/images/backgrounds/"></canvas>

<!-- NAVBAR
    ================================================== -->
    <div class="navbar-wrapper">
      <!-- Wrap the .navbar in .container to center it within the absolutely positioned parent. -->
      <div class="container">

        <div class="navbar navbar-inverse">
          <div class="navbar-inner">
            <!-- Responsive Navbar Part 1: Button for triggering responsive navbar (not covered in tutorial). Include responsive CSS to utilize. -->
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="brand" href="#">Widgets</a>
            <!-- Responsive Navbar Part 2: Place all navbar contents you want collapsed withing .navbar-collapse.collapse. -->
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
                <!-- Read about Bootstrap dropdowns at http://twitter.github.com/bootstrap/javascript.html#dropdowns -->
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Widgets <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="#"><i class="icon-plus-sign"></i> Add</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li class="nav-header">Nav header</li>
                    <li><a href="#">Separated link</a></li>
                    <li><a href="#">One more separated link</a></li>
                  </ul>
                </li>
              </ul>
            </div><!--/.nav-collapse -->
          </div><!-- /.navbar-inner -->
        </div><!-- /.navbar -->

      </div> <!-- /.container -->
    </div><!-- /.navbar-wrapper -->


<div class="container widget-main">
	<div class="row-fluid">
		<div class="span4 well">
			<h2>Heading</h2>
			<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>
		<div class="span4 well">
			<h2>Heading</h2>
			<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>
		<div class="span4 well">
			<h2>Heading</h2>
			<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>

	</div>
	<div class="row-fluid">
		<div class="span4 well">
			<h2>Heading</h2>
			<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>
		<div class="span4 well">
			<h2>Heading</h2>
			<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>
		<div class="span4 well">
			<h2>Heading</h2>
			<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>

	</div>
	<div class="row-fluid">
		<div class="span4 well">
			<h2>Heading</h2>
			<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>
		<div class="span4 well">
			<h2>Heading</h2>
			<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>
		<div class="span4 well">
			<h2>Heading</h2>
			<p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
			<p><a class="btn" href="#">View details &raquo;</a></p>
		</div>

	</div>
</div>

<script>
	(function($) {
		/**
		 * Light layer on top of a canvas element to represent an image displayed
		 * within.  Pass in a canvas element and an Image object and you'll see the
		 * image within the canvas element.  Use the provided methods (e.g. blur) to
		 * manipulate it.
		 *
		 * @constructor
		 * @param {HTMLElement} element HTML canvas element.
		 * @param {Image} image Image object.
		 */
		var CanvasImage = function(element, image) {
			this.image = image;
			this.element = element;
			this.element.width = this.image.width;
			this.element.height = this.image.height;
			this.context = this.element.getContext("2d");
			this.context.drawImage(this.image, 0, 0);
		};

		CanvasImage.prototype = {
			/**
			 * Runs a blur filter over the image.
			 *
			 * @param {int} strength Strength of the blur.
			 */
			blur: function (strength) {
				this.context.globalAlpha = 0.5; // Higher alpha made it more smooth
				// Add blur layers by strength to x and y
				// 2 made it a bit faster without noticeable quality loss
				for (var y = -strength; y <= strength; y += 2) {
					for (var x = -strength; x <= strength; x += 2) {
						// Apply layers
						this.context.drawImage(this.element, x, y);
						// Add an extra layer, prevents it from rendering lines
						// on top of the images (does makes it slower though)
						if (x>=0 && y>=0) {
							this.context.drawImage(this.element, -(x-1), -(y-1));
						}
					}
				}
				this.context.globalAlpha = 1.0;
			}
		};

		/**
		 * Initialise an image on the page and blur it.
		 */

		var canvas_el = $('canvas.blur');
		var photo_pool = 6;

		if (canvas_el.length) {
			var url = canvas_el.attr('data-src') + Math.floor((Math.random()*photo_pool)+1) + '.jpg',
				image,
				canvasImage;
				console.log(url);

			image = new Image();
			image.onload = function () {

				canvasImage = new CanvasImage(canvas_el[0], this);
				try{console.time('blur_4');}catch(err){}
				canvasImage.blur(4);
				try{console.timeEnd('blur_4');}catch(err){}
			};
			image.src = url;
		}
	})(jQuery);
</script>